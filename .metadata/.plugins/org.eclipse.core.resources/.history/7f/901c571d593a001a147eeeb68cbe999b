package com.shd.server.startup;

import java.io.IOException;
import java.security.NoSuchAlgorithmException;
import java.util.concurrent.CountDownLatch;

import javax.websocket.DeploymentException;

import org.glassfish.tyrus.server.Server;

import com.shd.common.properties.ReadAndCaptureProps;
import com.shd.server.Ref2Singleton;
public class MainServer {
public static void main(String[] args) throws  IOException, InterruptedException, DeploymentException, NoSuchAlgorithmException {
	
	//-DServerPropsDir="C:/WSServer2/WSServer2/Server/src/main/resources" where VM argument is: -DServerPropsDir="C:/WSServer2/WSServer2/Server/src/main/resources"
	String serverPropsDir =System.getProperty("ServerPropsDir");
	String propFile =  "ServerGen.properties" ;
	System.out.println("PropFileDirectory=[" + serverPropsDir +"]") ;
	ReadAndCaptureProps readAndCaptureProps = new ReadAndCaptureProps () ; 
	//*******************
	String propStrToDisply = readAndCaptureProps.readAndUpdProprsi1.andThen(readAndCaptureProps.dsplpropi2).apply(serverPropsDir,propFile);
	System.out.println("Prop Captured2 :\n" + propStrToDisply) ;  
	Ref2Singleton.ONEINSREF.setPropertyHashMap(readAndCaptureProps.getHashMap());
	readAndCaptureProps = null ;
	//*******************
	Server server1 = new Server("localhost", 8080, "", null, ServerEndPt1.class);
	ScanAndCapAnnotation scanAndCapAnnotation = new ScanAndCapAnnotation() ;
	scanAndCapAnnotation.scanAnot();
	scanAndCapAnnotation.capAnot() ;
	Ref2Singleton.ONEINSREF.getURIMap().printURIMapToReqRespAnnoted();
	//URIMap.printReqRespAnnoted();
	server1.start();
	Ref2Singleton.ONEINSREF.getServLogger().info("Server Started ...") ;
	new CountDownLatch(1).await();  //Wait and Keep Server Up
}
		   
}

/* run Server from Command line:
 * -1 cd C:\WSServer2\WSServer2\Server\target -2 java 	 * -DServerPropsDir="C:/WebSockt_WrkDirec/Server/Properties" -jar Server-1.0-jar-with-dependencies.jar 
 * Not: the Property file[ServerGen.propertie] for Server located in  C:\WebSockt_WrkDirec\Server\Properties
 */